<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="guildo-game" value="notranslate">
	<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="description" content="Guildo game development.">
	<title>Guildo Game</title>
	<link rel="stylesheet" href="assets/components/bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/init.css">
	<link rel="stylesheet" href="assets/css/personagens.css">
</head>
<body>
<div class="container">
	
	<div id="fase">
		<div id="guildo"></div>
		<div id="mapa"></div>
	</div>

	<div class="showPosition">
		<div>Pos:</div>
		<div id="left"></div>
		<div>:</div>
		<div id="top"></div>
	</div>
	
	
	<div id="DivBlockly"></div>
	<xml id="toolbox" style="display: none">
		<category name="Comandos">
			<!-- <block type="start"></block> -->
			<category name="Mover">
				<block type="move_right"></block>
				<!-- <block type="move_left"></block>
				<block type="move_top"></block>
				<block type="move_bottom"></block> -->
			</category>
		</category>
	</xml>
	
	<!-- Botões de ações do jogo
	<!-- <div class="row">
		<div class="col-sm-6 botoes-acoes">
			<button type="button" class="btn btn-success"><i class="glyphicon glyphicon-play"></i> Iniciar</button>
			<button type="button" class="btn btn-primary"><i class="glyphicon glyphicon-stop"></i> Parar</button>
			<button type="button" class="btn btn-danger"><i class="glyphicon glyphicon-refresh"></i> Recarregar</button>
			<button type="button" class="btn btn-default"><i class="glyphicon glyphicon-cog"></i> Configurações</button>
		</div>
	</div> -->

</div><!-- .container -->
<script src="assets/components/jquery/dist/jquery.min.js"></script>
<script src="assets/components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="assets/components/google-blockly/blockly_compressed.js"></script>
<script src="assets/components/google-blockly/blocks_compressed.js"></script>
<script src="assets/components/google-blockly/msg/js/pt-br.js"></script>
<script src="assets/js/script.js"></script>
<script type="text/javascript">
	
	//Load dos commandos do blockly
	var toolbox = document.getElementById('toolbox');
	var workspace = Blockly.inject('DivBlockly',{toolbox: toolbox});
	

	Blockly.Blocks['move_right'] = {
	  init: function() {
	    this.appendValueInput("PIXELS")
	        .setCheck("Number")
	        .appendField("Mover para direita");
	    this.setInputsInline(true);
	    this.setPreviousStatement(true, null);
	    this.setNextStatement(true, null);
	    this.setColour(290);
	    this.setTooltip('');
	    this.setHelpUrl('http://www.google.com/');
	  }
	};

	Blockly.JavaScript['move_right'] = function(block) {
	  var value_pixels = Blockly.JavaScript.valueToCode(block, 'PIXELS', Blockly.JavaScript.ORDER_ATOMIC);
	  // TODO: Assemble JavaScript into code variable.
	  var codeMoveRight = "$(\"#moveDiv\").animate({\n " + 
	                        "left: \"+=" + value_pixels + "px\"\n" +
	                      "},1000);\n";  
		// You can show a blockly warning
	    if( value_pixels >= 300 ) block.setWarningText("You get it!");

	    // Or you can store its value elsewere...
	    // myExternalVar = value_pixels;

  		return codeMoveRight;
	};

	var xml = Blockly.Xml.workspaceToDom(workspace);
	var xml_text = Blockly.Xml.domToText(xml); 
	console.log(xml_text);

	// Funcoes e scripts inerentes do personagem
	// e mapas do jogo
    $(document).ready(function(){
		//Carrega estado atual do personagem
		$('#guildo').addClass('front-stand');
		$('#top').html(charY);
		$('#left').html(charX);
    });

    //keyDown Function
	$(document).keydown(function(e){

		if (!currentKey && $("#guildo").queue("fx").length == 0 && $('#mapa').queue("fx").length == 0 ) {

			//Define a Key atual
			currentKey = e.keyCode;
			//Executa a função de movimento do personagem moveChar("<direcao a ser tomada>")
			switch(e.keyCode) {

				case 38: moveChar('up');    break;
				case 39: moveChar('right'); break;
				case 40: moveChar('down');  break;
				case 37: moveChar('left');  break;

			}

		}

	});

	//KeyUp Function
	$(document).keyup(function(e) {

		// Não para a caminhada se o jogador está pressionando outros botões
		// Só param a caminhada se a chave que começou a caminhada é liberado
		if (e.keyCode == currentKey) {
			//Define a chave atual como false, isso permite uma nova chave p/ ser informada
			currentKey = false;
		}

	});

</script>
</body>
</html>
